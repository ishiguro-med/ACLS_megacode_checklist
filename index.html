<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ACLSãƒ¡ã‚¬ã‚³ãƒ¼ãƒ‰ ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Bebas+Neue&display=swap" rel="stylesheet">
<style>
:root {
  --red:#C8102E; --red-dark:#9B0B22;
  --black:#111; --dark:#222; --gray-dark:#444; --gray:#777;
  --gray-light:#E5E5E5; --off-white:#F4F5F7;
  --green:#166534; --green-bg:#DCFCE7;
  --amber:#B45309; --amber-bg:#FEF3C7;
  --shadow:0 2px 16px rgba(0,0,0,0.10);
}
* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html, body { height:100%; }
body { font-family:'Noto Sans JP',sans-serif; background:var(--off-white); color:var(--black); }

/* â”€â”€ SCREENS â”€â”€ */
.screen { display:none; min-height:100vh; }
.screen.active { display:block; }
#screen-select.active { display:flex; flex-direction:column; background:var(--black); }

/* â”€â”€ SELECT SCREEN â”€â”€ */
.sel-header {
  background:var(--red); padding:28px 24px 22px;
  position:relative; overflow:hidden;
}
.sel-header::before {
  content:''; position:absolute; right:-20px; top:-20px;
  width:160px; height:160px; border-radius:50%; background:rgba(255,255,255,0.07);
}
.sel-logo { font-family:'Bebas Neue',sans-serif; font-size:12px; letter-spacing:3px; color:rgba(255,255,255,0.6); margin-bottom:6px; }
.sel-title { font-family:'Bebas Neue',sans-serif; font-size:38px; color:white; letter-spacing:2px; line-height:1; margin-bottom:5px; }
.sel-sub { font-size:12px; color:rgba(255,255,255,0.75); font-weight:500; }
.sel-body { flex:1; padding:22px 18px 36px; }
.sel-label { font-size:10px; font-weight:700; letter-spacing:2px; color:rgba(255,255,255,0.35); text-transform:uppercase; margin-bottom:14px; }

.sc-card {
  background:#1C1C1C; border:1.5px solid #2A2A2A; border-radius:12px;
  padding:16px 18px; margin-bottom:10px; cursor:pointer;
  display:flex; align-items:center; gap:14px;
  transition:all 0.2s; position:relative; overflow:hidden;
}
.sc-card::before {
  content:''; position:absolute; left:0; top:0; bottom:0;
  width:4px; background:var(--red); border-radius:4px 0 0 4px; opacity:0; transition:opacity 0.2s;
}
.sc-card:active, .sc-card:hover { background:#252525; border-color:var(--red); transform:translateX(4px); }
.sc-card:active::before, .sc-card:hover::before { opacity:1; }
.sc-num { font-family:'Bebas Neue',sans-serif; font-size:34px; color:var(--red); line-height:1; flex-shrink:0; width:34px; text-align:center; }
.sc-info { flex:1; }
.sc-case { font-size:9px; font-weight:700; letter-spacing:1px; color:rgba(255,255,255,0.3); margin-bottom:3px; }
.sc-flow { font-size:15px; font-weight:700; color:white; line-height:1.3; }
.sc-flow b { color:var(--red); }
.sc-arr { color:rgba(255,255,255,0.2); font-size:22px; flex-shrink:0; }

/* â”€â”€ CHECKLIST HEADER â”€â”€ */
.cl-header {
  background:var(--red); padding:13px 14px 9px;
  position:sticky; top:0; z-index:100;
  box-shadow:0 3px 18px rgba(200,16,46,0.45);
}
.cl-htop { display:flex; align-items:center; gap:10px; margin-bottom:7px; }
.btn-back {
  background:rgba(255,255,255,0.15); border:none; color:white;
  width:32px; height:32px; border-radius:7px; font-size:18px; cursor:pointer;
  display:flex; align-items:center; justify-content:center; flex-shrink:0; transition:background 0.15s;
}
.btn-back:active { background:rgba(255,255,255,0.28); }
.cl-htxt { flex:1; }
.cl-htitle { font-family:'Bebas Neue',sans-serif; font-size:18px; color:white; letter-spacing:1px; line-height:1; }
.cl-hsub { font-size:10px; color:rgba(255,255,255,0.78); font-weight:500; margin-top:1px; }
.prog-wrap { display:flex; align-items:center; gap:8px; }
.prog-bg { flex:1; height:5px; background:rgba(0,0,0,0.2); border-radius:4px; overflow:hidden; }
.prog-bar { height:100%; background:white; border-radius:4px; width:0%; transition:width 0.4s cubic-bezier(0.34,1.56,0.64,1); }
.prog-txt { font-size:11px; font-weight:700; color:rgba(255,255,255,0.88); white-space:nowrap; }

/* â”€â”€ CONTENT â”€â”€ */
.cl-content { padding:12px 12px 24px; max-width:760px; margin:0 auto; }

.info-row {
  background:white; border-radius:9px; padding:11px 13px;
  margin-bottom:10px; box-shadow:var(--shadow);
  display:grid; grid-template-columns:1fr 1fr; gap:10px;
}
.info-field label { display:block; font-size:10px; font-weight:700; color:var(--gray); letter-spacing:0.5px; margin-bottom:3px; }
.info-field input {
  width:100%; border:1.5px solid var(--gray-light); border-radius:7px;
  padding:8px 10px; font-size:14px; font-family:'Noto Sans JP',sans-serif;
  outline:none; transition:border-color 0.2s; color:var(--black);
}
.info-field input:focus { border-color:var(--red); }

/* â”€â”€ SECTION â”€â”€ */
.section { background:white; border-radius:9px; margin-bottom:9px; box-shadow:var(--shadow); overflow:hidden; }
.sec-hd { padding:10px 13px; display:flex; align-items:center; gap:9px; cursor:pointer; user-select:none; }
.sec-hd.s-team  { background:#111; }
.sec-hd.s-brady { background:#1a3a5c; }
.sec-hd.s-tachy { background:#5c2a00; }
.sec-hd.s-vf    { background:#6b1a1a; }
.sec-hd.s-pvt   { background:#4a1a6b; }
.sec-hd.s-pea   { background:#1a5c2a; }
.sec-hd.s-asys  { background:#2a2a5c; }
.sec-hd.s-rosc  { background:var(--red-dark); }
.sec-icon { font-size:15px; width:28px; height:28px; background:rgba(255,255,255,0.12); border-radius:6px; display:flex; align-items:center; justify-content:center; flex-shrink:0; }
.sec-name { flex:1; font-size:13px; font-weight:900; color:white; letter-spacing:0.3px; }
.sec-badge { font-size:10px; font-weight:700; background:rgba(255,255,255,0.18); color:white; border-radius:20px; padding:2px 8px; transition:all 0.2s; }
.sec-badge.done { background:white; color:var(--green); }
.chev { font-size:11px; color:rgba(255,255,255,0.45); transition:transform 0.25s; }
.section.closed .chev { transform:rotate(-90deg); }
.section.closed .sec-bd { display:none; }
.sec-bd { padding:3px 0; }

/* â”€â”€ CHECK ITEM â”€â”€ */
.ci {
  display:flex; align-items:flex-start; gap:11px; padding:9px 13px;
  border-bottom:1px solid #F2F2F2; cursor:pointer; user-select:none; transition:background 0.15s;
}
.ci:last-child { border-bottom:none; }
.ci:active { background:#F5F5F5; }
.ci.on { background:var(--green-bg); }
.cb {
  width:30px; height:30px; border:2px solid var(--gray-light); border-radius:7px;
  flex-shrink:0; display:flex; align-items:center; justify-content:center;
  background:white; transition:all 0.2s cubic-bezier(0.34,1.56,0.64,1); margin-top:1px;
}
.ci.on .cb { background:var(--green); border-color:var(--green); transform:scale(1.06); }
.ck { opacity:0; transform:scale(0) rotate(-15deg); transition:all 0.22s cubic-bezier(0.34,1.56,0.64,1); font-size:15px; color:white; font-weight:900; line-height:1; }
.ci.on .ck { opacity:1; transform:scale(1) rotate(0deg); }
.ci-txt { font-size:13px; line-height:1.5; color:var(--gray-dark); flex:1; padding-top:4px; }
.ci.on .ci-txt { color:var(--green); text-decoration:line-through; text-decoration-color:rgba(22,101,52,0.35); }

/* â”€â”€ CPR SUB â”€â”€ */
.cpr-wrap { flex:1; }
.cpr-lbl { font-size:13px; line-height:1.5; color:var(--gray-dark); margin-bottom:7px; padding-top:4px; }
.ci.on .cpr-lbl { color:var(--green); }
.cpr-grid { display:grid; grid-template-columns:repeat(5,1fr); gap:4px; margin-bottom:3px; }
.sub-cb { border:1.5px solid var(--gray-light); border-radius:6px; padding:5px 3px; text-align:center; cursor:pointer; background:white; transition:all 0.18s; user-select:none; }
.sub-cb.on { background:var(--green-bg); border-color:var(--green); }
.sub-box { width:14px; height:14px; border:1.5px solid var(--gray-light); border-radius:3px; margin:0 auto 3px; display:flex; align-items:center; justify-content:center; font-size:9px; color:white; font-weight:900; transition:all 0.18s; background:white; }
.sub-cb.on .sub-box { background:var(--green); border-color:var(--green); }
.sub-txt { font-size:8px; font-weight:700; color:var(--gray); line-height:1.3; }
.sub-cb.on .sub-txt { color:var(--green); }
.opt-tag { display:inline-block; font-size:7px; background:var(--amber-bg); color:var(--amber); border-radius:3px; padding:1px 3px; margin-top:1px; font-weight:700; }

/* â”€â”€ DRUG SUB â”€â”€ */
.drug-wrap { flex:1; }
.drug-main-lbl { font-size:13px; line-height:1.5; color:var(--gray-dark); margin-bottom:8px; padding-top:4px; cursor:pointer; }
.ci.on .drug-main-lbl { color:var(--green); }
.drug-row { display:flex; gap:8px; }
.drug-cb {
  display:flex; align-items:center; gap:7px;
  border:1.5px solid var(--gray-light); border-radius:8px;
  padding:7px 12px; cursor:pointer; background:white;
  transition:all 0.18s; user-select:none; flex:1;
}
.drug-cb.on { background:var(--green-bg); border-color:var(--green); }
.drug-box {
  width:22px; height:22px; border:1.5px solid var(--gray-light);
  border-radius:5px; display:flex; align-items:center; justify-content:center;
  flex-shrink:0; background:white; transition:all 0.18s;
}
.drug-cb.on .drug-box { background:var(--green); border-color:var(--green); }
.drug-ck { font-size:13px; color:white; font-weight:900; opacity:0; transform:scale(0); transition:all 0.18s cubic-bezier(0.34,1.56,0.64,1); }
.drug-cb.on .drug-ck { opacity:1; transform:scale(1); }
.drug-lbl { font-size:13px; font-weight:700; color:var(--gray-dark); }
.drug-cb.on .drug-lbl { color:var(--green); }
.drug-row.rosc-row { flex-wrap:wrap; gap:6px; }
.drug-row.rosc-row .drug-cb { flex:1 1 calc(50% - 3px); min-width:0; }

/* â”€â”€ RESULT PANEL â”€â”€ */
.result-panel { display:none; background:white; border-radius:9px; margin-bottom:9px; box-shadow:var(--shadow); overflow:hidden; }
.result-panel.show { display:block; }
.result-inner { padding:14px; }
.result-badge { border-radius:8px; padding:14px; text-align:center; margin-bottom:10px; }
.result-badge.pass { background:var(--green-bg); border:2px solid var(--green); }
.result-badge.fail { background:var(--amber-bg); border:2px solid #D97706; }
.r-icon { font-size:34px; margin-bottom:3px; }
.r-word { font-size:22px; font-weight:900; letter-spacing:2px; }
.result-badge.pass .r-word { color:var(--green); }
.result-badge.fail .r-word { color:var(--amber); }
.r-note { font-size:12px; color:var(--gray); margin-top:4px; }
.missed-box { background:#FFF7ED; border-radius:7px; padding:9px 11px; }
.missed-hd { font-size:11px; font-weight:700; color:var(--amber); margin-bottom:5px; }
.missed-item { font-size:12px; color:var(--gray-dark); padding:3px 0; border-bottom:1px solid #FDEBD0; display:flex; gap:5px; }
.missed-item:last-child { border-bottom:none; }
.missed-item::before { content:'â€º'; color:var(--amber); font-weight:900; flex-shrink:0; }

/* â”€â”€ ACTION BAR â”€â”€ */
.action-bar { display:grid; grid-template-columns:1fr 1fr; gap:9px; margin-bottom:10px; }
.btn { padding:13px; border-radius:9px; border:none; font-size:13px; font-weight:700; font-family:'Noto Sans JP',sans-serif; cursor:pointer; display:flex; align-items:center; justify-content:center; gap:6px; transition:all 0.18s; letter-spacing:0.3px; }
.btn:active { transform:scale(0.97); }
.btn-check { background:var(--black); color:white; grid-column:1/-1; }
.btn-reset { background:var(--gray-light); color:var(--gray-dark); }

/* â”€â”€ TOAST â”€â”€ */
.toast { position:fixed; bottom:22px; left:50%; transform:translateX(-50%) translateY(60px); background:var(--dark); color:white; padding:10px 18px; border-radius:22px; font-size:12px; font-weight:700; z-index:999; transition:transform 0.3s cubic-bezier(0.34,1.56,0.64,1); white-space:nowrap; box-shadow:0 4px 18px rgba(0,0,0,0.3); }
.toast.show { transform:translateX(-50%) translateY(0); }
</style>
</head>
<body>

<!-- â•â• SCREEN 1: SCENARIO SELECT â•â• -->
<div id="screen-select" class="screen active">
  <div class="sel-header">
    <div class="sel-logo">ACLS INSTRUCTOR TOOL</div>
    <div class="sel-title">MEGACODE<br>CHECKLIST</div>
    <div class="sel-sub">ãƒ¡ã‚¬ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ«ãƒ†ã‚¹ãƒˆã€€ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ç”¨</div>
  </div>
  <div class="sel-body">
    <div class="sel-label">ã‚·ãƒŠãƒªã‚ªã‚’é¸æŠ</div>
    <div class="sc-card" onclick="openScenario(0)">
      <div class="sc-num">1</div>
      <div class="sc-info">
        <div class="sc-case">ã‚±ãƒ¼ã‚¹ 56/59</div>
        <div class="sc-flow">å¾è„ˆ â†’ <b>VF</b> â†’ å¿ƒé™æ­¢ â†’ PCAC</div>
      </div>
      <div class="sc-arr">â€º</div>
    </div>
    <div class="sc-card" onclick="openScenario(1)">
      <div class="sc-num">2</div>
      <div class="sc-info">
        <div class="sc-case">ã‚±ãƒ¼ã‚¹ 51/54</div>
        <div class="sc-flow">å¾è„ˆ â†’ <b>VF</b> â†’ PEA â†’ PCAC</div>
      </div>
      <div class="sc-arr">â€º</div>
    </div>
    <div class="sc-card" onclick="openScenario(2)">
      <div class="sc-num">3</div>
      <div class="sc-info">
        <div class="sc-case">ã‚±ãƒ¼ã‚¹ 49/52/57/60/62</div>
        <div class="sc-flow">é »æ‹ â†’ <b>VF</b> â†’ PEA â†’ PCAC</div>
      </div>
      <div class="sc-arr">â€º</div>
    </div>
    <div class="sc-card" onclick="openScenario(3)">
      <div class="sc-num">4</div>
      <div class="sc-info">
        <div class="sc-case">ã‚±ãƒ¼ã‚¹ 55/58</div>
        <div class="sc-flow">é »æ‹ â†’ ç„¡è„ˆæ€§ <b>VT</b> â†’ PEA â†’ PCAC</div>
      </div>
      <div class="sc-arr">â€º</div>
    </div>
  </div>
</div>

<!-- â•â• SCREEN 2: CHECKLIST â•â• -->
<div id="screen-checklist" class="screen">
  <div class="cl-header">
    <div class="cl-htop">
      <button class="btn-back" onclick="goBack()">â€¹</button>
      <div class="cl-htxt">
        <div class="cl-htitle" id="cl-title">MEGACODE</div>
        <div class="cl-hsub" id="cl-sub"></div>
      </div>
    </div>
    <div class="prog-wrap">
      <div class="prog-bg"><div class="prog-bar" id="prog-bar"></div></div>
      <div class="prog-txt" id="prog-txt">0 / 0</div>
    </div>
  </div>

  <div class="cl-content">
    <div class="info-row">
      <div class="info-field">
        <label>å—è¬›è€…å</label>
        <input type="text" id="learner" placeholder="æ°åã‚’å…¥åŠ›">
      </div>
      <div class="info-field">
        <label>ãƒ†ã‚¹ãƒˆæ—¥</label>
        <input type="date" id="testdate">
      </div>
    </div>

    <div id="sections-container"></div>

    <div class="result-panel" id="result-panel">
      <div class="result-inner">
        <div class="result-badge" id="r-badge">
          <div class="r-icon" id="r-icon">ğŸ‰</div>
          <div class="r-word" id="r-word">åˆæ ¼</div>
          <div class="r-note" id="r-note"></div>
        </div>
        <div id="missed-wrap" style="display:none">
          <div class="missed-box">
            <div class="missed-hd">âš ï¸ æœªãƒã‚§ãƒƒã‚¯é …ç›®</div>
            <div id="missed-list"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="action-bar">
      <button class="btn btn-check" onclick="showResult()">ğŸ“Š çµæœã‚’ç¢ºèªã™ã‚‹</button>
      <button class="btn btn-reset" onclick="doReset()">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/* â•â• SCENARIO DATA â•â• */
const SCENARIOS = [
  {
    case: 'ã‚±ãƒ¼ã‚¹ 56/59',
    flow: 'å¾è„ˆ â†’ VF â†’ å¿ƒé™æ­¢ â†’ PCAC',
    sections: [
      { id:'team', name:'ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼', icon:'ğŸ‘¥', style:'s-team', items:[
        { text:'ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã«å½¹å‰²ã‚’å‰²ã‚Šå½“ã¦ã‚‹' },
        { type:'cpr', text:'ã¤ã­ã«è³ªã®é«˜ã„CPRãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹' },
        { text:'ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒé©åˆ‡ã«ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹' }
      ]},
      { id:'brady', name:'å¾è„ˆã®ç®¡ç†', icon:'ğŸ©º', style:'s-brady', items:[
        { text:'å¿…è¦ã«å¿œã˜ã¦é…¸ç´ æŠ•ä¸ã‚’é–‹å§‹ã—ã€ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’è£…ç€ã—ã¦é™è„ˆè·¯ã‚’ç¢ºä¿ã™ã‚‹' },
        { text:'ãƒ¢ãƒ‹ã‚¿ãƒ¼ãƒªãƒ¼ãƒ‰ã‚’é©åˆ‡ãªä½ç½®ã«è£…ç€ã™ã‚‹' },
        { text:'ç—‡å€™æ€§å¾è„ˆã ã¨èªè­˜ã™ã‚‹' },
        { text:'é©åˆ‡ãªç”¨é‡ã®ã‚¢ãƒˆãƒ­ãƒ”ãƒ³ã‚’æŠ•ä¸ã™ã‚‹' },
        { text:'äºŒæ¬¡æ²»ç™‚ã®æº–å‚™ã‚’ã™ã‚‹' }
      ]},
      { id:'vf', name:'VF ã®ç®¡ç†', icon:'ğŸ’“', style:'s-vf', items:[
        { text:'VF ã‚’èªè­˜ã™ã‚‹' },
        { text:'å¿ƒãƒªã‚ºãƒ è§£æå‰ã¨ã‚·ãƒ§ãƒƒã‚¯æ–½è¡Œå‰ã«æ‚£è€…ã‹ã‚‰é›¢ã‚Œã‚‹' },
        { text:'ã‚·ãƒ§ãƒƒã‚¯æ–½è¡Œå¾Œã€ãŸã ã¡ã« CPR ã‚’å†é–‹ã™ã‚‹' },
        { text:'é©åˆ‡ãªæ°—é“ç®¡ç†ã‚’è¡Œã†' },
        { text:'æŠ•è–¬ã€å¿ƒãƒªã‚ºãƒ ã®ãƒã‚§ãƒƒã‚¯/ã‚·ãƒ§ãƒƒã‚¯ã€CPR ã‚’é©åˆ‡ãªã‚µã‚¤ã‚¯ãƒ«ã§æ–½è¡Œã™ã‚‹' },
        { type:'drug', text:'é©åˆ‡ãªè–¬ç‰©ã‚’é©åˆ‡ãªç”¨é‡ã§æŠ•ä¸ã™ã‚‹' }
      ]},
      { id:'asys', name:'å¿ƒé™æ­¢ã®ç®¡ç†', icon:'ğŸ“‰', style:'s-asys', items:[
        { text:'å¿ƒé™æ­¢ã‚’èªè­˜ã™ã‚‹' },
        { text:'å¿ƒé™æ­¢ã®æ²»ç™‚å¯èƒ½ãªåŸå› ã«ã¤ã„ã¦å£é ­ã§èª¬æ˜ã™ã‚‹ï¼ˆH ã¨ Tï¼‰' },
        { text:'é©åˆ‡ãªè–¬ç‰©ã‚’é©åˆ‡ãªç”¨é‡ã§æŠ•ä¸ã™ã‚‹' },
        { text:'å¿ƒãƒªã‚ºãƒ ã¨è„ˆæ‹ã®ãƒã‚§ãƒƒã‚¯å¾Œã€ç›´ã¡ã« CPR ã‚’å†é–‹ã™ã‚‹' }
      ]},
      { id:'rosc', name:'å¿ƒæ‹å†é–‹å¾Œã®æ²»ç™‚', icon:'ğŸ¥', style:'s-rosc', items:[
        { text:'ROSC ã‚’ç¢ºèªã™ã‚‹' },
        { type:'rosc-detail', text:'è¡€åœ§æ¸¬å®šã¨12èª˜å°å¿ƒé›»å›³ã‚’å®Ÿæ–½ã—ã€é…¸ç´ é£½å’Œåº¦ã‚’æ¸¬å®šã—ã€æ°—ç®¡æŒ¿ç®¡ã¨æ³¢å½¢è¡¨ç¤ºå‘¼æ°—COâ‚‚ãƒ¢ãƒ‹ã‚¿ãƒ¼ã®å¿…è¦æ€§ã‚’å£é ­ã§èª¬æ˜ã—ã€è‡¨åºŠæ¤œæŸ»ã‚’æŒ‡ç¤ºã™ã‚‹' },
        { text:'ç›®æ¨™ã‚’è¨­å®šã—ãŸä½“æ¸©ç®¡ç†ã‚’æ¤œè¨ã™ã‚‹' }
      ]}
    ]
  },
  {
    case: 'ã‚±ãƒ¼ã‚¹ 51/54',
    flow: 'å¾è„ˆ â†’ VF â†’ PEA â†’ PCAC',
    sections: [
      { id:'team', name:'ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼', icon:'ğŸ‘¥', style:'s-team', items:[
        { text:'ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã«å½¹å‰²ã‚’å‰²ã‚Šå½“ã¦ã‚‹' },
        { type:'cpr', text:'ã¤ã­ã«è³ªã®é«˜ã„CPRãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹' },
        { text:'ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒé©åˆ‡ã«ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹' }
      ]},
      { id:'brady', name:'å¾è„ˆã®ç®¡ç†', icon:'ğŸ©º', style:'s-brady', items:[
        { text:'å¿…è¦ã«å¿œã˜ã¦é…¸ç´ æŠ•ä¸ã‚’é–‹å§‹ã—ã€ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’è£…ç€ã—ã¦é™è„ˆè·¯ã‚’ç¢ºä¿ã™ã‚‹' },
        { text:'ãƒ¢ãƒ‹ã‚¿ãƒ¼ãƒªãƒ¼ãƒ‰ã‚’é©åˆ‡ãªä½ç½®ã«è£…ç€ã™ã‚‹' },
        { text:'ç—‡å€™æ€§å¾è„ˆã ã¨èªè­˜ã™ã‚‹' },
        { text:'é©åˆ‡ãªç”¨é‡ã®ã‚¢ãƒˆãƒ­ãƒ”ãƒ³ã‚’æŠ•ä¸ã™ã‚‹' },
        { text:'äºŒæ¬¡æ²»ç™‚ã®æº–å‚™ã‚’ã™ã‚‹' }
      ]},
      { id:'vf', name:'VF ã®ç®¡ç†', icon:'ğŸ’“', style:'s-vf', items:[
        { text:'VF ã‚’èªè­˜ã™ã‚‹' },
        { text:'å¿ƒãƒªã‚ºãƒ è§£æå‰ã¨ã‚·ãƒ§ãƒƒã‚¯æ–½è¡Œå‰ã«æ‚£è€…ã‹ã‚‰é›¢ã‚Œã‚‹' },
        { text:'ã‚·ãƒ§ãƒƒã‚¯æ–½è¡Œå¾Œã€ãŸã ã¡ã« CPR ã‚’å†é–‹ã™ã‚‹' },
        { text:'é©åˆ‡ãªæ°—é“ç®¡ç†ã‚’è¡Œã†' },
        { text:'æŠ•è–¬ã€å¿ƒãƒªã‚ºãƒ ã®ãƒã‚§ãƒƒã‚¯/ã‚·ãƒ§ãƒƒã‚¯ã€CPR ã‚’é©åˆ‡ãªã‚µã‚¤ã‚¯ãƒ«ã§æ–½è¡Œã™ã‚‹' },
        { type:'drug', text:'é©åˆ‡ãªè–¬ç‰©ã‚’é©åˆ‡ãªç”¨é‡ã§æŠ•ä¸ã™ã‚‹' }
      ]},
      { id:'pea', name:'PEA ã®ç®¡ç†', icon:'ğŸ«€', style:'s-pea', items:[
        { text:'PEA ã‚’èªè­˜ã™ã‚‹' },
        { text:'PEA ã®æ²»ç™‚å¯èƒ½ãªåŸå› ã«ã¤ã„ã¦å£é ­ã§èª¬æ˜ã™ã‚‹ï¼ˆH ã¨ Tï¼‰' },
        { text:'é©åˆ‡ãªè–¬ç‰©ã‚’é©åˆ‡ãªç”¨é‡ã§æŠ•ä¸ã™ã‚‹' },
        { text:'å¿ƒãƒªã‚ºãƒ ã¨è„ˆæ‹ã®ãƒã‚§ãƒƒã‚¯å¾Œã€ç›´ã¡ã« CPR ã‚’å†é–‹ã™ã‚‹' }
      ]},
      { id:'rosc', name:'å¿ƒæ‹å†é–‹å¾Œã®æ²»ç™‚', icon:'ğŸ¥', style:'s-rosc', items:[
        { text:'ROSC ã‚’ç¢ºèªã™ã‚‹' },
        { type:'rosc-detail', text:'è¡€åœ§æ¸¬å®šã¨12èª˜å°å¿ƒé›»å›³ã‚’å®Ÿæ–½ã—ã€é…¸ç´ é£½å’Œåº¦ã‚’æ¸¬å®šã—ã€æ°—ç®¡æŒ¿ç®¡ã¨æ³¢å½¢è¡¨ç¤ºå‘¼æ°—COâ‚‚ãƒ¢ãƒ‹ã‚¿ãƒ¼ã®å¿…è¦æ€§ã‚’å£é ­ã§èª¬æ˜ã—ã€è‡¨åºŠæ¤œæŸ»ã‚’æŒ‡ç¤ºã™ã‚‹' },
        { text:'ç›®æ¨™ã‚’è¨­å®šã—ãŸä½“æ¸©ç®¡ç†ã‚’æ¤œè¨ã™ã‚‹' }
      ]}
    ]
  },
  {
    case: 'ã‚±ãƒ¼ã‚¹ 49/52/57/60/62',
    flow: 'é »æ‹ â†’ VF â†’ PEA â†’ PCAC',
    sections: [
      { id:'team', name:'ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼', icon:'ğŸ‘¥', style:'s-team', items:[
        { text:'ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã«å½¹å‰²ã‚’å‰²ã‚Šå½“ã¦ã‚‹' },
        { type:'cpr', text:'ã¤ã­ã«è³ªã®é«˜ã„CPRãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹' },
        { text:'ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒé©åˆ‡ã«ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹' }
      ]},
      { id:'tachy', name:'é »æ‹ã®ç®¡ç†', icon:'âš¡', style:'s-tachy', items:[
        { text:'å¿…è¦ã«å¿œã˜ã¦é…¸ç´ æŠ•ä¸ã‚’é–‹å§‹ã—ã€ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’è£…ç€ã—ã¦é™è„ˆè·¯ã‚’ç¢ºä¿ã™ã‚‹' },
        { text:'ãƒ¢ãƒ‹ã‚¿ãƒ¼ãƒªãƒ¼ãƒ‰ã‚’é©åˆ‡ãªä½ç½®ã«è£…ç€ã™ã‚‹' },
        { text:'ä¸å®‰å®šã ã¨èªè­˜ã™ã‚‹' },
        { text:'ãŸã ã¡ã«åŒæœŸé›»æ°—ã‚·ãƒ§ãƒƒã‚¯ã‚’å®Ÿæ–½ã™ã‚‹' }
      ]},
      { id:'vf', name:'VF ã®ç®¡ç†', icon:'ğŸ’“', style:'s-vf', items:[
        { text:'VF ã‚’èªè­˜ã™ã‚‹' },
        { text:'å¿ƒãƒªã‚ºãƒ è§£æå‰ã¨ã‚·ãƒ§ãƒƒã‚¯æ–½è¡Œå‰ã«æ‚£è€…ã‹ã‚‰é›¢ã‚Œã‚‹' },
        { text:'ã‚·ãƒ§ãƒƒã‚¯æ–½è¡Œå¾Œã€ãŸã ã¡ã« CPR ã‚’å†é–‹ã™ã‚‹' },
        { text:'é©åˆ‡ãªæ°—é“ç®¡ç†ã‚’è¡Œã†' },
        { text:'æŠ•è–¬ã€å¿ƒãƒªã‚ºãƒ ã®ãƒã‚§ãƒƒã‚¯/ã‚·ãƒ§ãƒƒã‚¯ã€CPR ã‚’é©åˆ‡ãªã‚µã‚¤ã‚¯ãƒ«ã§æ–½è¡Œã™ã‚‹' },
        { type:'drug', text:'é©åˆ‡ãªè–¬ç‰©ã‚’é©åˆ‡ãªç”¨é‡ã§æŠ•ä¸ã™ã‚‹' }
      ]},
      { id:'pea', name:'PEA ã®ç®¡ç†', icon:'ğŸ«€', style:'s-pea', items:[
        { text:'PEA ã‚’èªè­˜ã™ã‚‹' },
        { text:'PEA ã®æ²»ç™‚å¯èƒ½ãªåŸå› ã«ã¤ã„ã¦å£é ­ã§èª¬æ˜ã™ã‚‹ï¼ˆH ã¨ Tï¼‰' },
        { text:'é©åˆ‡ãªè–¬ç‰©ã‚’é©åˆ‡ãªç”¨é‡ã§æŠ•ä¸ã™ã‚‹' },
        { text:'å¿ƒãƒªã‚ºãƒ ã¨è„ˆæ‹ã®ãƒã‚§ãƒƒã‚¯å¾Œã€ç›´ã¡ã« CPR ã‚’å†é–‹ã™ã‚‹' }
      ]},
      { id:'rosc', name:'å¿ƒæ‹å†é–‹å¾Œã®æ²»ç™‚', icon:'ğŸ¥', style:'s-rosc', items:[
        { text:'ROSC ã‚’ç¢ºèªã™ã‚‹' },
        { type:'rosc-detail', text:'è¡€åœ§æ¸¬å®šã¨12èª˜å°å¿ƒé›»å›³ã‚’å®Ÿæ–½ã—ã€é…¸ç´ é£½å’Œåº¦ã‚’æ¸¬å®šã—ã€æ°—ç®¡æŒ¿ç®¡ã¨æ³¢å½¢è¡¨ç¤ºå‘¼æ°—COâ‚‚ãƒ¢ãƒ‹ã‚¿ãƒ¼ã®å¿…è¦æ€§ã‚’å£é ­ã§èª¬æ˜ã—ã€è‡¨åºŠæ¤œæŸ»ã‚’æŒ‡ç¤ºã™ã‚‹' },
        { text:'ç›®æ¨™ã‚’è¨­å®šã—ãŸä½“æ¸©ç®¡ç†ã‚’æ¤œè¨ã™ã‚‹' }
      ]}
    ]
  },
  {
    case: 'ã‚±ãƒ¼ã‚¹ 55/58',
    flow: 'é »æ‹ â†’ ç„¡è„ˆæ€§VT â†’ PEA â†’ PCAC',
    sections: [
      { id:'team', name:'ãƒãƒ¼ãƒ ãƒªãƒ¼ãƒ€ãƒ¼', icon:'ğŸ‘¥', style:'s-team', items:[
        { text:'ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã«å½¹å‰²ã‚’å‰²ã‚Šå½“ã¦ã‚‹' },
        { type:'cpr', text:'ã¤ã­ã«è³ªã®é«˜ã„CPRãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹' },
        { text:'ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ãŒé©åˆ‡ã«ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹' }
      ]},
      { id:'tachy', name:'é »æ‹ã®ç®¡ç†', icon:'âš¡', style:'s-tachy', items:[
        { text:'å¿…è¦ã«å¿œã˜ã¦é…¸ç´ æŠ•ä¸ã‚’é–‹å§‹ã—ã€ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’è£…ç€ã—ã¦é™è„ˆè·¯ã‚’ç¢ºä¿ã™ã‚‹' },
        { text:'ãƒ¢ãƒ‹ã‚¿ãƒ¼ãƒªãƒ¼ãƒ‰ã‚’é©åˆ‡ãªä½ç½®ã«è£…ç€ã™ã‚‹' },
        { text:'ä¸å®‰å®šã ã¨èªè­˜ã™ã‚‹' },
        { text:'é »æ‹ã‚’åŸå› ã¨ã™ã‚‹ç—‡çŠ¶ã‚’èªè­˜ã™ã‚‹' },
        { text:'ãŸã ã¡ã«åŒæœŸé›»æ°—ã‚·ãƒ§ãƒƒã‚¯ã‚’å®Ÿæ–½ã™ã‚‹' }
      ]},
      { id:'pvt', name:'ç„¡è„ˆæ€§VT ã®ç®¡ç†', icon:'ğŸ“¡', style:'s-pvt', items:[
        { text:'ç„¡è„ˆæ€§VT ã‚’åˆ¤å®šã™ã‚‹' },
        { text:'å¿ƒãƒªã‚ºãƒ è§£æå‰ã¨ã‚·ãƒ§ãƒƒã‚¯æ–½è¡Œå‰ã«æ‚£è€…ã‹ã‚‰é›¢ã‚Œã‚‹' },
        { text:'ã‚·ãƒ§ãƒƒã‚¯æ–½è¡Œå¾Œã€ãŸã ã¡ã« CPR ã‚’å†é–‹ã™ã‚‹' },
        { text:'é©åˆ‡ãªæ°—é“ç®¡ç†ã‚’è¡Œã†' },
        { text:'æŠ•è–¬ã€å¿ƒãƒªã‚ºãƒ ã®ãƒã‚§ãƒƒã‚¯/ã‚·ãƒ§ãƒƒã‚¯ã€CPR ã‚’é©åˆ‡ãªã‚µã‚¤ã‚¯ãƒ«ã§æ–½è¡Œã™ã‚‹' },
        { type:'drug', text:'é©åˆ‡ãªè–¬ç‰©ã‚’é©åˆ‡ãªç”¨é‡ã§æŠ•ä¸ã™ã‚‹' }
      ]},
      { id:'pea', name:'PEA ã®ç®¡ç†', icon:'ğŸ«€', style:'s-pea', items:[
        { text:'PEA ã‚’èªè­˜ã™ã‚‹' },
        { text:'PEA ã®æ²»ç™‚å¯èƒ½ãªåŸå› ã«ã¤ã„ã¦å£é ­ã§èª¬æ˜ã™ã‚‹ï¼ˆH ã¨ Tï¼‰' },
        { text:'é©åˆ‡ãªè–¬ç‰©ã‚’é©åˆ‡ãªç”¨é‡ã§æŠ•ä¸ã™ã‚‹' },
        { text:'å¿ƒãƒªã‚ºãƒ ã¨è„ˆæ‹ã®ãƒã‚§ãƒƒã‚¯å¾Œã€ç›´ã¡ã« CPR ã‚’å†é–‹ã™ã‚‹' }
      ]},
      { id:'rosc', name:'å¿ƒæ‹å†é–‹å¾Œã®æ²»ç™‚', icon:'ğŸ¥', style:'s-rosc', items:[
        { text:'ROSC ã‚’ç¢ºèªã™ã‚‹' },
        { type:'rosc-detail', text:'è¡€åœ§æ¸¬å®šã¨12èª˜å°å¿ƒé›»å›³ã‚’å®Ÿæ–½ã—ã€é…¸ç´ é£½å’Œåº¦ã‚’æ¸¬å®šã—ã€æ°—ç®¡æŒ¿ç®¡ã¨æ³¢å½¢è¡¨ç¤ºå‘¼æ°—COâ‚‚ãƒ¢ãƒ‹ã‚¿ãƒ¼ã®å¿…è¦æ€§ã‚’å£é ­ã§èª¬æ˜ã—ã€è‡¨åºŠæ¤œæŸ»ã‚’æŒ‡ç¤ºã™ã‚‹' },
        { text:'ç›®æ¨™ã‚’è¨­å®šã—ãŸä½“æ¸©ç®¡ç†ã‚’æ¤œè¨ã™ã‚‹' }
      ]}
    ]
  }
];

/* â•â• STATE â•â• */
let curIdx = null;

/* â•â• NAVIGATION â•â• */
function openScenario(idx) {
  curIdx = idx;
  buildChecklist(SCENARIOS[idx]);
  document.getElementById('screen-select').classList.remove('active');
  document.getElementById('screen-checklist').classList.add('active');
  window.scrollTo(0, 0);
}

function goBack() {
  document.getElementById('screen-checklist').classList.remove('active');
  document.getElementById('screen-select').classList.add('active');
  window.scrollTo(0, 0);
}

/* â•â• BUILD CHECKLIST â•â• */
function buildChecklist(sc) {
  document.getElementById('cl-title').textContent = 'MEGACODE  ' + sc.case;
  document.getElementById('cl-sub').textContent = sc.flow;
  document.getElementById('result-panel').classList.remove('show');
  document.getElementById('testdate').value = new Date().toISOString().split('T')[0];
  document.getElementById('learner').value = '';

  const container = document.getElementById('sections-container');
  container.innerHTML = '';
  sc.sections.forEach(sec => container.appendChild(buildSection(sec)));
  updateProgress();
}

function buildSection(sec) {
  const wrap = document.createElement('div');
  wrap.className = 'section';
  wrap.id = 'sec-' + sec.id;

  const hd = document.createElement('div');
  hd.className = 'sec-hd ' + sec.style;
  hd.innerHTML =
    '<div class="sec-icon">' + sec.icon + '</div>' +
    '<div class="sec-name">' + sec.name + '</div>' +
    '<div class="sec-badge" id="badge-' + sec.id + '">0/' + sec.items.length + '</div>' +
    '<div class="chev">â–¼</div>';
  hd.addEventListener('click', function() { wrap.classList.toggle('closed'); });
  wrap.appendChild(hd);

  const bd = document.createElement('div');
  bd.className = 'sec-bd';
  sec.items.forEach(function(item, ii) {
    if (item.type === 'cpr') {
      bd.appendChild(buildCPR(sec.id, ii));
    } else if (item.type === 'drug') {
      bd.appendChild(buildDrug(item.text, sec.id, ii));
    } else if (item.type === 'rosc-detail') {
      bd.appendChild(buildROSCDetail(item.text, sec.id, ii));
    } else {
      bd.appendChild(buildCI(item.text, sec.id, ii));
    }
  });
  wrap.appendChild(bd);
  return wrap;
}

function buildCI(text, secId, idx) {
  const div = document.createElement('div');
  div.className = 'ci';
  div.dataset.sec = secId;
  div.dataset.idx = idx;
  div.innerHTML = '<div class="cb"><span class="ck">âœ“</span></div><div class="ci-txt">' + text + '</div>';
  div.addEventListener('click', function() { div.classList.toggle('on'); updateProgress(); });
  return div;
}

function buildCPR(secId, idx) {
  const div = document.createElement('div');
  div.className = 'ci';
  div.dataset.sec = secId;
  div.dataset.idx = idx;
  const subs = [
    { l:'åœ§è¿«ã®ãƒ†ãƒ³ãƒ<br>100ã€œ120å›/åˆ†', o:false },
    { l:'åœ§è¿«ã®æ·±ã•<br>â‰§5cm', o:false },
    { l:'èƒ¸éª¨åœ§è¿«ã®<br>å‰²åˆ >80%', o:false },
    { l:'èƒ¸éƒ­ã®æˆ»ã‚Š', o:true },
    { l:'æ›æ°—', o:true }
  ];
  var subHtml = subs.map(function(s, i) {
    return '<div class="sub-cb" data-s="' + i + '"><div class="sub-box">âœ“</div><div class="sub-txt">' + s.l + (s.o ? '<br><span class="opt-tag">ã‚ªãƒ—ã‚·ãƒ§ãƒ³</span>' : '') + '</div></div>';
  }).join('');
  div.innerHTML =
    '<div class="cb"><span class="ck">âœ“</span></div>' +
    '<div class="cpr-wrap">' +
      '<div class="cpr-lbl">ã¤ã­ã«è³ªã®é«˜ã„CPRãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹</div>' +
      '<div class="cpr-grid">' + subHtml + '</div>' +
    '</div>';
  div.querySelector('.cb').addEventListener('click', function(e) { e.stopPropagation(); div.classList.toggle('on'); updateProgress(); });
  div.querySelector('.cpr-lbl').addEventListener('click', function() { div.classList.toggle('on'); updateProgress(); });
  div.querySelectorAll('.sub-cb').forEach(function(s) {
    s.addEventListener('click', function(e) { e.stopPropagation(); s.classList.toggle('on'); });
  });
  return div;
}

function buildDrug(text, secId, idx) {
  const div = document.createElement('div');
  div.className = 'ci';
  div.dataset.sec = secId;
  div.dataset.idx = idx;
  var drugsHtml =
    '<div class="drug-cb" data-d="0"><div class="drug-box"><span class="drug-ck">âœ“</span></div><div class="drug-lbl">ã‚¢ãƒ‰ãƒ¬ãƒŠãƒªãƒ³</div></div>' +
    '<div class="drug-cb" data-d="1"><div class="drug-box"><span class="drug-ck">âœ“</span></div><div class="drug-lbl">ã‚¢ãƒŸã‚ªãƒ€ãƒ­ãƒ³</div></div>';
  div.innerHTML =
    '<div class="cb"><span class="ck">âœ“</span></div>' +
    '<div class="drug-wrap">' +
      '<div class="drug-main-lbl">' + text + '</div>' +
      '<div class="drug-row">' + drugsHtml + '</div>' +
    '</div>';
  div.querySelector('.cb').addEventListener('click', function(e) { e.stopPropagation(); div.classList.toggle('on'); updateProgress(); });
  div.querySelector('.drug-main-lbl').addEventListener('click', function() { div.classList.toggle('on'); updateProgress(); });
  div.querySelectorAll('.drug-cb').forEach(function(d) {
    d.addEventListener('click', function(e) { e.stopPropagation(); d.classList.toggle('on'); });
  });
  return div;
}

function buildROSCDetail(text, secId, idx) {
  var div = document.createElement('div');
  div.className = 'ci';
  div.dataset.sec = secId;
  div.dataset.idx = idx;

  var roscItems = [
    'è¡€åœ§æ¸¬å®šã¨12èª˜å°å¿ƒé›»å›³',
    'é…¸ç´ é£½å’Œåº¦ã®æ¸¬å®š',
    'æ°—ç®¡æŒ¿ç®¡ã¨ETCOâ‚‚ãƒ¢ãƒ‹ã‚¿',
    'è‡¨åºŠæ¤œæŸ»'
  ];
  var subsHtml = roscItems.map(function(label, i) {
    return '<div class="drug-cb" data-d="' + i + '">' +
      '<div class="drug-box"><span class="drug-ck">âœ“</span></div>' +
      '<div class="drug-lbl">' + label + '</div>' +
      '</div>';
  }).join('');

  div.innerHTML =
    '<div class="cb"><span class="ck">âœ“</span></div>' +
    '<div class="drug-wrap">' +
      '<div class="drug-main-lbl">' + text + '</div>' +
      '<div class="drug-row rosc-row">' + subsHtml + '</div>' +
    '</div>';

  div.querySelector('.cb').addEventListener('click', function(e) {
    e.stopPropagation(); div.classList.toggle('on'); updateProgress();
  });
  div.querySelector('.drug-main-lbl').addEventListener('click', function() {
    div.classList.toggle('on'); updateProgress();
  });
  div.querySelectorAll('.drug-cb').forEach(function(d) {
    d.addEventListener('click', function(e) { e.stopPropagation(); d.classList.toggle('on'); });
  });
  return div;
}

/* â•â• PROGRESS â•â• */
function updateProgress() {
  var all = document.querySelectorAll('.ci[data-sec]');
  var done = document.querySelectorAll('.ci[data-sec].on');
  var t = all.length, c = done.length;
  document.getElementById('prog-bar').style.width = (t ? c / t * 100 : 0) + '%';
  document.getElementById('prog-txt').textContent = c + ' / ' + t;
  if (curIdx === null) return;
  SCENARIOS[curIdx].sections.forEach(function(sec) {
    var sa = document.querySelectorAll('.ci[data-sec="' + sec.id + '"]');
    var sd = document.querySelectorAll('.ci[data-sec="' + sec.id + '"].on');
    var b = document.getElementById('badge-' + sec.id);
    if (!b) return;
    b.textContent = sd.length + '/' + sa.length;
    b.classList.toggle('done', sd.length === sa.length && sa.length > 0);
  });
}

/* â•â• RESULT â•â• */
function showResult() {
  var all = document.querySelectorAll('.ci[data-sec]');
  var done = document.querySelectorAll('.ci[data-sec].on');
  var t = all.length, c = done.length;
  var panel = document.getElementById('result-panel');
  var badge = document.getElementById('r-badge');
  var icon  = document.getElementById('r-icon');
  var word  = document.getElementById('r-word');
  var note  = document.getElementById('r-note');
  var mw    = document.getElementById('missed-wrap');
  var ml    = document.getElementById('missed-list');

  panel.classList.add('show');
  if (c === t) {
    badge.className = 'result-badge pass';
    icon.textContent = 'ğŸ‰'; word.textContent = 'åˆæ ¼';
    note.textContent = 'å…¨ ' + t + ' é …ç›®ã‚¯ãƒªã‚¢ï¼'; mw.style.display = 'none';
  } else {
    badge.className = 'result-badge fail';
    icon.textContent = 'âš ï¸'; word.textContent = 'è¦è£œç¿’';
    note.textContent = c + ' / ' + t + ' é …ç›®ï¼ˆæ®‹ã‚Š ' + (t - c) + ' é …ç›®ï¼‰';
    ml.innerHTML = '';
    document.querySelectorAll('.ci[data-sec]:not(.on)').forEach(function(el) {
      var txt = (el.querySelector('.ci-txt') || el.querySelector('.drug-main-lbl') || el.querySelector('.cpr-lbl'));
      if (txt && txt.textContent.trim()) {
        var d = document.createElement('div');
        d.className = 'missed-item';
        d.textContent = txt.textContent.trim();
        ml.appendChild(d);
      }
    });
    mw.style.display = 'block';
  }
  panel.scrollIntoView({ behavior:'smooth', block:'nearest' });
}

/* â•â• RESET â•â• */
function doReset() {
  if (!confirm('ãƒã‚§ãƒƒã‚¯ã‚’ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) return;
  document.querySelectorAll('.ci').forEach(function(el) { el.classList.remove('on'); });
  document.querySelectorAll('.sub-cb').forEach(function(el) { el.classList.remove('on'); });
  document.querySelectorAll('.drug-cb').forEach(function(el) { el.classList.remove('on'); });
  document.getElementById('learner').value = '';
  document.getElementById('testdate').value = new Date().toISOString().split('T')[0];
  document.getElementById('result-panel').classList.remove('show');
  updateProgress();
  showToast('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
}

/* â•â• TOAST â•â• */
function showToast(msg) {
  var t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(function() { t.classList.remove('show'); }, 2000);
}
</script>
</body>
</html>
